%clear

mMoon =7.348e22;% kg
mEarth = 5.9742e24; %kg
mu = mMoon/(mMoon + mEarth);


tLimit = 4

u1 = 1-mu;
u2=mu;

x= 1-mu
Vy= [0.0160866450431292];
y = -0.0387208288357215;
Vx_i = 0.396850868014576;
        
X = [x y Vx_i Vy]
C1 = jacobiConstant( X(1,1:2),X(1,3:4),mu)
%X = [0.987849886237367 -0.147193198313387 0.0433317948808526 -0.129650344384800]

ode__opt = odeset('RelTol',1e-13,'AbsTol',1e-22);
numSteps=500;
tspan=linspace(0, 10,numSteps);
[t,X_forward]=ode113(@CRTBPForward,[0,3],X,ode__opt,mu);

Vy= -0.0160639961500446;
y = -0.101638126457988;
Vx_i2 = 0.220093581614412;

X = [x y Vx_i2 Vy]
C2 = jacobiConstant( X(1,1:2),X(1,3:4),mu)
[t,X_backward]=ode113(@CRTBPBackward,[0 3],X,ode__opt,mu);

%% plot all
figure
hold on

line(X_forward(:,1), X_forward(:,2),'Color','b')
line(X_backward(:,1), X_backward(:,2),'Color','r')
title('Trayectoria de baja energia entre orbitas periódicas Lyapunov');
grid on;
xlabel('x')
ylabel('y')
